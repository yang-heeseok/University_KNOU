name: Daily Tech Blog Crawler

on:
    schedule:
        # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (UTC 0ì‹œ)ì— ì‹¤í–‰
        - cron: '0 0 * * *'
    workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
    crawl-and-summarize:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Python
              uses: actions/setup-python@v4
              with:
                  python-version: '3.11'
                  cache: 'pip'

            - name: Install dependencies
              run: |
                  pip install -r automation/crawler/requirements.txt

            - name: Run crawler
              env:
                  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
                  CLAUDE_API_KEY: ${{ secrets.CLAUDE_API_KEY }}
                  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
                  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
              run: |
                  cd automation/crawler
                  python main.py

            - name: Commit and push changes
              run: |
                  git config --local user.email "action@github.com"
                  git config --local user.name "GitHub Action"
                  git add research/trends/
                  git diff --staged --quiet || git commit -m "ğŸ¤– Daily tech blog summary - $(date +'%Y-%m-%d')"
                  git push

            - name: Notify completion
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  message: |
                      ğŸ“° ì˜¤ëŠ˜ì˜ ê¸°ìˆ  ë¸”ë¡œê·¸ ìš”ì•½ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!

                      ğŸ“… ë‚ ì§œ: $(date +'%Yë…„ %mì›” %dì¼')
                      ğŸ” í¬ë¡¤ë§ ì™„ë£Œ: 6ê°œ ë¸”ë¡œê·¸
                      ğŸ“ ìš”ì•½ ìƒì„±: AI ê¸°ë°˜ ìë™ ìš”ì•½

                      í™•ì¸í•˜ê¸°: https://github.com/${{ github.repository }}/tree/main/research/trends

                      #ê¸°ìˆ ë¸”ë¡œê·¸ #ì¼ì¼ìš”ì•½ #ìë™í™”
